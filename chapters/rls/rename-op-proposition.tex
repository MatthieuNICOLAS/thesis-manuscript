Notre opération de renommage réassigne des identifiants arbitraires aux éléments de la séquence de réduire son surcoût en métadonnées.

\begin{figure}[t!]
  \centering
  \subfloat[Choix du nouvel identifiant pour le premier élément]{
      \begin{minipage}{\linewidth}
          \centering
          \resizebox{0.7 \columnwidth}{!}{
          \begin{tikzpicture}
            \newcommand\nodeh[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}$}] {H}
            }
            \newcommand\nodee[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}\betterid{f}{A0}{0}$}] {E}
            }
            \newcommand\nodelo[1]{
                node[block, label=#1:{$\betterid{i}{B0}{1..2}$}] {LO}
            }
            \newcommand\renh[1]{
                node[letter, label=#1:{$\betterid{i}{A1}{0}$}] {H}
            }

            \newcommand\initialstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \nodeh{-#3}
                ++(0:\widthletter) \nodee{#3}
                ++(0:\widthletter) \nodelo{-#3};
            }

            \newcommand\finalstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \renh{-#3};
            }

            \newcommand\offseta{ (90:0.7) }

            \path
                node {\textbf{A}}
                ++(0:0.5) node (a) {}
                +(0:14) node (a-end) {}
                +(0:2) node[point] (a-initial) {}
                +(0:8) node[point, label=-170:{$\trm{ren}()$}, label={[xshift=0pt]-10:{$\trm{ren(A,1)}$}}] (a-ren-a1) {}
                +(0:12) node (a-final) {};

            \initialstate{(a-initial)}{\offseta}{90};
            \finalstate{(a-ren-a1)}{\offseta}{90};

            \draw[dotted] (a) -- (a-initial) (a-final) -- (a-end);
            \draw[->, thick] (a-initial) --  (a-ren-a1) -- (a-final);
            %   \path
            %       node {\textbf{A}}
            %       ++(0:\widthletter) node[letter, label=below:{\id{i}{B0}{0}}] {H}
            %       ++(0:\widthletter) node[letter, fill=mydarkorange, label=above:{\color{mydarkorange}\id{i}{B0}{0}\id{f}{A0}{0}}] {E}
            %       ++(0:\widthletter) node[block, label=below:{\id{i}{B0}{1..2}}] (LO) {LO}
            %       ++(0:4 * \widthletter) node[letter, fill=mydarkblue, label=below:{\color{mydarkblueid}\id{i}{A1}{0}}] (H) {H};

            %   \draw[->, thick] (LO) -- node[below, align=center]{\emph{rename}} (H);
          \end{tikzpicture}}
          \label{fig:renaming-first-id}
      \end{minipage}}
  \hfil
  \subfloat[Choix des nouveaux identifiants pour les éléments restants]{
      \begin{minipage}{\linewidth}
          \centering
          \resizebox{0.7 \columnwidth}{!}{
          \begin{tikzpicture}
            \newcommand\nodeh[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}$}] {H}
            }
            \newcommand\nodee[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}\betterid{f}{A0}{0}$}] {E}
            }
            \newcommand\nodelo[1]{
                node[block, label=#1:{$\betterid{i}{B0}{1..2}$}] {LO}
            }
            \newcommand\renh[1]{
                node[letter, label=#1:{$\betterid{i}{A1}{0}$}] {H}
            }
            \newcommand\rene[1]{
                node[letter, label=#1:{$\betterid{i}{A1}{1}$}] {E}
            }
            \newcommand\renl[1]{
                node[letter, label=#1:{$\betterid{i}{A1}{2}$}] {L}
            }
            \newcommand\reno[1]{
                node[letter, label=#1:{$\betterid{i}{A1}{3}$}] {O}
            }

            \newcommand\initialstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \nodeh{-#3}
                ++(0:\widthletter) \nodee{#3}
                ++(0:\widthletter) \nodelo{-#3};
            }

            \newcommand\finalstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \renh{-#3}
                ++(0:\widthletter) \rene{-#3}
                ++(0:\widthletter) \renl{-#3}
                ++(0:\widthletter) \reno{-#3};
            }

            \newcommand\offseta{ (90:0.7) }

            \path
                node {\textbf{A}}
                ++(0:0.5) node (a) {}
                +(0:14) node (a-end) {}
                +(0:2) node[point] (a-initial) {}
                +(0:8) node[point, label=-170:{$\trm{ren}()$}, label={[xshift=0pt]-10:{$\trm{ren(A,1)}$}}] (a-ren-a1) {}
                +(0:12) node (a-final) {};

            \initialstate{(a-initial)}{\offseta}{90};
            \finalstate{(a-ren-a1)}{\offseta}{90};

            \draw[dotted] (a) -- (a-initial) (a-final) -- (a-end);
            \draw[->, thick] (a-initial) --  (a-ren-a1) -- (a-final);
          \end{tikzpicture}}
          \label{fig:renaming-second-id}
      \end{minipage}}
  \hfil
  \subfloat[État final obtenu]{
      \begin{minipage}{\linewidth}
          \centering
          \resizebox{0.7 \columnwidth}{!}{
          \begin{tikzpicture}
            \newcommand\nodeh[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}$}] {H}
            }
            \newcommand\nodee[1]{
                node[letter, label=#1:{$\betterid{i}{B0}{0}\betterid{f}{A0}{0}$}] {E}
            }
            \newcommand\nodelo[1]{
                node[block, label=#1:{$\betterid{i}{B0}{1..2}$}] {LO}
            }
            \newcommand\renhelo[1]{
                node[block, label=#1:{$\betterid{i}{A1}{0..3}$}] {HELO}
            }

            \newcommand\initialstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \nodeh{-#3}
                ++(0:\widthletter) \nodee{#3}
                ++(0:\widthletter) \nodelo{-#3};
            }

            \newcommand\finalstate[3]{
                \path
                #1
                ++#2
                ++(0:0.5)
                ++(#3:0.5) \renhelo{-#3};
            }

            \newcommand\offseta{ (90:0.7) }

            \path
                node {\textbf{A}}
                ++(0:0.5) node (a) {}
                +(0:14) node (a-end) {}
                +(0:2) node[point] (a-initial) {}
                +(0:8) node[point, label=-170:{$\trm{ren}()$}, label={[xshift=0pt]-10:{$\trm{ren(A,1)}$}}] (a-ren-a1) {}
                +(0:12) node (a-final) {};

            \initialstate{(a-initial)}{\offseta}{90};
            \finalstate{(a-ren-a1)}{\offseta}{90};

            \draw[dotted] (a) -- (a-initial) (a-final) -- (a-end);
            \draw[->, thick] (a-initial) --  (a-ren-a1) -- (a-final);
          \end{tikzpicture}}
          \label{fig:renaming-final-state}
      \end{minipage}}
  \caption{Renommage de la séquence sur le noeud \emph{A}}
  \label{fig:renaming}
\end{figure}

Son comportement est illustré dans la \autoref{fig:renaming}.
Dans cet exemple, le noeud A initie une opération \emph{rename} sur son état local.
Tout d'abord, le noeud A génère un nouvel identifiant à partir du premier tuple de l'identifiant du premier élément de la séquence (\id{i}{B0}{0}).
Pour générer ce nouvel identifiant, le noeud A reprend la position de ce tuple (\emph{i}) mais utilise son propre identifiant de noeud (\textbf{A}) et numéro de séquence actuel (\emph{1}).
De plus, son offset est mis à 0.
Le noeud A réassigne l'identifiant résultant (\id{i}{A1}{0}) au premier élément de la séquence, comme décrit dans la \autoref{fig:renaming-first-id}.
Ensuite, le noeud A dérive des identifiants contigus pour tous les éléments restants en incrémentant de manière successive l'offset (\id{i}{A1}{1}, \id{i}{A1}{2}, \id{i}{A1}{3}), comme présenté dans la \autoref{fig:renaming-second-id}.
Comme nous assignons des identifiants consécutifs à tous les éléments de la séquence, nous pouvons au final aggréger ces éléments en un seul bloc, comme illustré en \autoref{fig:renaming-final-state}.
Ceci permet aux noeuds de bénéficier au mieux de la fonctionnalité des blocs et de minimiser le surcoût en métadonnés de l'état résultat.

Pour converger, les autres noeuds doivent renommer leur état de manière identique.
Cependant, ils ne peuvent pas simplement remplacer leur état courant par l'état généré par le renommage.
En effet, ils peuvent avoir modifié en concurrence leur état.
Afin de ne pas perdre ces modifications, les noeuds doivent traiter l'opération \emph{rename} eux-mêmes.
Pour ce faire, le noeud qui a généré l'opération \emph{rename} diffuse les données sur lesquelles il a basé son renommage aux autres, \ie son \emph{ancien état}.

\begin{definition}[Ancien état]
  \label{def:former-state}
  Un \emph{ancien état} est la liste des intervalles d'identifiants qui composent l'état courant de la séquence répliquée au moment du renommage.
\end{definition}

De ce fait, nous définissons l'opération \emph{rename} de la manière suivante :

\begin{definition}[rename]
  \label{def:rename-op}
  Une opération \emph{rename} est un triplet $\langle \trm{nodeId}, \trm{nodeSeq}, \trm{formerState} \rangle$ où
  \begin{itemize}
    \item $\trm{nodeId}$ est l'identifiant du noeud qui a généré l'opération \emph{rename}.
    \item $\trm{nodeSeq}$ est le numéro de séquence du noeud au moment de la génération de l'opération \emph{rename}.
    \item $\trm{formerState}$ est l'ancien état du noeud au moment du renommage.
  \end{itemize}
\end{definition}

En utilisant ces données, les autres noeuds calculent le nouvel identifiant de chaque identifiant renommé.
Concernant les identifiants insérés de manière concurrente au renommage, nous expliquons dans la \autoref{sec:ops-concurrent-to-rename} comment les noeuds peuvent les renommer de manière déterministe.
